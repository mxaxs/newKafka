(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[24],{384:function(t,e,n){n.r(e);var i=n(2),o=n(16),a=n(1);t=n(48);var r=n(32),s=n(9);n=function(){function t(){this.init()}return t.prototype.init=function(){this.dY=!1,this.xe=this.lj=this.connection=null,this.Wo={},this.za=this.BA=null},t.prototype.Daa=function(t){for(var e=this,n=0;n<t.length;++n){var i=t[n];switch(i.at){case"create":this.Wo[i.author]||(this.Wo[i.author]=i.aName),this.F3(i);break;case"modify":this.za.Pp(i.xfdf).then((function(t){e.za.JP(t[0])}));break;case"delete":this.za.Pp("<delete><id>"+i.aId+"</id></delete>")}}},t.prototype.F3=function(t){var e=this;this.za.Pp(t.xfdf).then((function(n){n=n[0],n.authorId=t.author,e.za.JP(n),e.za.trigger(o.a.UPDATE_ANNOTATION_PERMISSION,[n])}))},t.prototype.e3=function(t,e,n){this.lj&&this.lj(t,e,n)},t.prototype.preloadAnnotations=function(t){this.addEventListener("webViewerServerAnnotationsEnabled",this.e3.bind(this,t,"add",{imported:!1}),{once:!0})},t.prototype.initiateCollaboration=function(e,n,i){var s=this;if(e){s.xe=n,s.za=i.Da(),i.addEventListener(o.c.DOCUMENT_UNLOADED,(function(){s.disableCollaboration()})),s.Zaa(e);var d=new XMLHttpRequest;d.addEventListener("load",(function(){if(200===d.status&&0<d.responseText.length)try{var n=JSON.parse(d.responseText);s.connection=exports.Na.Fba(Object(r.h)(s.xe,"blackbox/"),"annot"),s.BA=n.id,s.Wo[n.id]=n.user_name,s.za.GQ(n.id),s.connection.NG((function(t){t.t&&t.t.startsWith("a_")&&t.data&&s.Daa(t.data)}),(function(){s.connection.send({t:"a_retrieve",dId:e}),s.trigger(t.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[s.Wo[n.id],s.BA])}),(function(){s.disableCollaboration()}))}catch(i){Object(a.g)(i.message)}})),d.open("GET",Object(r.h)(this.xe,"demo/SessionInfo.jsp")),d.withCredentials=!0,d.send(),s.dY=!0,s.za.q9((function(t){return s.Wo[t.Author]||t.Author}))}else Object(a.g)("Document ID required for collaboration")},t.prototype.disableCollaboration=function(){this.lj&&(this.za.removeEventListener(s.a.Events.ANNOTATION_CHANGED,this.lj),this.lj=null),this.connection&&this.connection.$C(),this.za&&this.za.GQ("Guest"),this.init(),this.trigger(t.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)},t.prototype.Zaa=function(t){var e=this;this.lj&&this.za.removeEventListener(s.a.Events.ANNOTATION_CHANGED,this.lj),this.lj=function(n,o,a){return Object(i.b)(this,void 0,void 0,(function(){var r,s,d,h,l,c,u,E,f;return Object(i.d)(this,(function(i){switch(i.label){case 0:return a.imported?[2]:(r={t:"a_"+o,dId:t,annots:[]},[4,e.za.a0()]);case 1:for(s=i.fa(),"delete"!==o&&(d=(new DOMParser).parseFromString(s,"text/xml"),h=new XMLSerializer),l=0;l<n.length;l++)c=n[l],E=u=void 0,"add"===o?(u=d.querySelector('[name="'+c.Id+'"]'),E=h.serializeToString(u),f=null,c.InReplyTo&&(f=e.za.qD(c.InReplyTo).authorId||"default"),r.annots.push({at:"create",aId:c.Id,author:e.BA,aName:e.Wo[e.BA],parent:f,xfdf:"<add>"+E+"</add>"})):"modify"===o?(u=d.querySelector('[name="'+c.Id+'"]'),E=h.serializeToString(u),r.annots.push({at:"modify",aId:c.Id,xfdf:"<modify>"+E+"</modify>"})):"delete"===o&&r.annots.push({at:"delete",aId:c.Id});return 0<r.annots.length&&e.connection.send(r),[2]}}))}))}.bind(e),this.za.addEventListener(s.a.Events.ANNOTATION_CHANGED,this.lj)},t.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"},t}(),Object(t.a)(n),e["default"]=n}}])}).call(this||window);