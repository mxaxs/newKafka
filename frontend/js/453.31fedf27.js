"use strict";(globalThis["webpackChunknexar_xm"]=globalThis["webpackChunknexar_xm"]||[]).push([[453],{65453:(e,s,t)=>{t.r(s),t.d(s,{default:()=>L});var o=t(59835),a=t(61957),n=t(86970),r=t(15166),l=t.n(r);const i=e=>((0,o.dD)("data-v-79268c81"),e=e(),(0,o.Cn)(),e),c={class:"row-grow"},d={class:"col-grow"},u=i((()=>(0,o._)("div",{class:"text-h4 text-weight-light"},"Nexar-XM",-1))),m=i((()=>(0,o._)("div",{class:"text-subtitle2 relative-position",style:{top:"-10px"}}," by Nexar Systems ",-1))),p={class:"row justify-center full-width q-px-md"},g=(0,o.Uk)("Entrar"),h={class:"row justify-evenly full-width"};function w(e,s,t,r,i,w){const f=(0,o.up)("q-img"),v=(0,o.up)("q-input"),y=(0,o.up)("q-icon"),_=(0,o.up)("q-card-section"),x=(0,o.up)("q-btn"),b=(0,o.up)("q-card-actions"),q=(0,o.up)("q-card"),S=(0,o.up)("q-form"),k=(0,o.up)("q-page");return(0,o.wg)(),(0,o.j4)(k,{padding:""},{default:(0,o.w5)((()=>[(0,o._)("div",c,[(0,o._)("div",d,[(0,o.Wm)(f,{src:l(),class:"fixed-top q-ma-lg",width:"56px"}),(0,o.Wm)(S,null,{default:(0,o.w5)((()=>[(0,o.Wm)(q,{class:"myCard container fixed-center"},{default:(0,o.w5)((()=>[(0,o.Wm)(_,{class:"q-ml-md q-mr-md"},{default:(0,o.w5)((()=>[u,m,(0,o.Wm)(v,{autocomplete:"",dense:"",modelValue:r.email,"onUpdate:modelValue":s[0]||(s[0]=e=>r.email=e),outlined:"",type:"email",class:"q-mb-md q-mt-md bg-btn",onKeydown:(0,a.D2)((0,a.iM)(r.login,["prevent"]),["enter"])},null,8,["modelValue","onKeydown"]),(0,o.Wm)(v,{modelValue:r.password,"onUpdate:modelValue":s[2]||(s[2]=e=>r.password=e),outlined:"",class:(0,n.C_)(["bg-btn",i.isPwd?"pass-input":""]),autocomplete:!1,dense:"",type:i.isPwd?"password":"text",onKeydown:(0,a.D2)((0,a.iM)(r.login,["prevent"]),["enter"])},{append:(0,o.w5)((()=>[(0,o.Wm)(y,{name:i.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:s[1]||(s[1]=e=>i.isPwd=!i.isPwd)},null,8,["name"])])),_:1},8,["modelValue","type","class","onKeydown"])])),_:1}),(0,o.Wm)(_),(0,o.Wm)(b,{class:"absolute-bottom"},{default:(0,o.w5)((()=>[(0,o._)("div",p,[(0,o.Wm)(x,{flat:"",class:"text-white shadow-2 bg-btn full-width",onClick:s[3]||(s[3]=e=>r.login())},{default:(0,o.w5)((()=>[g])),_:1})]),(0,o._)("div",h,[(0,o._)("div",{class:"text-caption text-white q-mt-sm",style:{cursor:"pointer"},onClick:s[4]||(s[4]=e=>r.firstAccess())}," Primeiro acesso "),(0,o._)("div",{class:"text-caption text-white q-mt-sm",style:{cursor:"pointer"},onClick:s[5]||(s[5]=e=>r.resetPass(r.auth))}," Esqueci a senha ")])])),_:1})])),_:1})])),_:1})])])])),_:1})}var f=t(19302),v=t(60499),y=t(28339),_=t(94886),x=t(55834),b=t(98100),q=t.n(b),S=t(74001),k=t(4779),E=t(63078),H=t(65992),C=t(78248),P=t(58163);const I={name:"LoginPage",data(){return{isPwd:!0}},setup(){const e=(0,y.tv)(),s=(0,P.A)(),t=()=>{e.push({path:"/fa"})},a=(0,S.L)({uri:"https://nexarxm.top/v1/graphql",headers:{"x-hasura-admin-secret":"esteehomeusegred0qu3f01descoberto"}}),n=new k.h,r=new E.f({link:a,cache:n});(0,_.UK)(r);const l=x.ZP`
      query user($email: String!) {
        user: nxm_users(where: { email: { _eq: $email } }) {
          projects
          scope
          phone
          email
          surname
          nodes
          hubs
          name
          doc_id
          doc_uf
          doc_type
          cpf
          access_level
          type
          id
        }
      }
    `,i=(0,H.v0)(),c=(0,f.Z)(),d=(0,v.iH)({fetchPolicy:"cache-network",notifyOnNetworkStatusChange:!0}),u=(0,v.iH)("7code777"),m=(0,v.iH)("node1@nexar.systems"),p=e.currentRoute.value.query;console.log("THE URI >>>>>",p);const g=function(){c.dialog({dark:!0,title:"Ooops!",message:"Usuário ou Senha inválido(s)",ok:{flat:!0}}).onOk((()=>{})).onCancel((()=>{})).onDismiss((()=>{}))},h=(0,v.iH)(0),w=(0,o.Fl)((()=>`online/${h.value}/`)),b=(e,t,o,a,n,r)=>{const l=(0,C.N8)(),i=(0,C.iH)(l,w.value);(0,C.jM)(i,(t=>{console.log("THE SNAPSHOT DATA>>>>>",t.val());const o=t.val();if(t){const e=[];for(const s in o)e.push({id:s,type:o[s].type,email:o[s].email,phone:o[s].phone,name:o[s].name,scope:o[s].scope,loggedAt:o[s].loggedAt}),console.log(`${s}: ${o[s].email}`);sessionStorage.setItem("onlineUsers",JSON.stringify(e)),s.$state.onlineUsers=e}else I(e)}));const c={email:t,phone:n,name:o,type:a,loggedAt:Date.now(),scope:r},d={},u={};return d[w.value+e]=c,u[w.value+e]=null,(0,C.ae)((0,C.iH)(l)).update(u),(0,C.Vx)((0,C.iH)(l),d).then((()=>{(0,v.iH)(l,w.value)})).catch((e=>console.error("THE DB ERROR >>>>",e)))},I=async e=>{const s=(0,C.N8)(),t={};t[w.value+e]=null,(0,C.Vx)((0,C.iH)(s),t).then((e=>(console.warn("THE DB RESULT >>>>",e),e))).catch((e=>(console.error("THE DB ERROR >>>>",e),e)))};(0,o.bv)((()=>{(0,H.Aj)(i,(s=>{if(s){const{onResult:t}=(0,_.aM)(l,{email:s.email},d);t((s=>{const t=s.data.user[0];if(void 0===t)c.dialog({dark:!0,title:"Ooops!",message:"Seu usuário já se encontra cadastrado na plataforma, mas ainda não foi liberado. Por favor, entre em contato com o Administrador e solicite sua liberação.",ok:{flat:!0}}).onOk((()=>(0,H.w7)(i)));else{h.value=s.data.user[0].projects[0];const o=s.data.user[0].doc_id,a=s.data.user[0].type,n=s.data.user[0].email,r=s.data.user[0].phone,l=s.data.user[0].scope,i=`${s.data.user[0].name} ${s.data.user[0].surname}`;b(o,n,i,a,r,l),sessionStorage.setItem("loggedUser",JSON.stringify(t)),sessionStorage.setItem("laudando","false"),sessionStorage.setItem("sendExamType","ECG"),localStorage.setItem("current_cpf",t.cpf);const c=R(a);e.push({path:c})}}))}else{const e=sessionStorage.getItem("loggedUser")?JSON.parse(sessionStorage.getItem("loggedUser"))["doc_id"]:null;e&&I(e),sessionStorage.removeItem("loggedUser")}}))}));const R=e=>{var s={1:"/medic",2:"/client",3:"/requester",4:"/project",5:"/node",6:"/hub"};return s[e]},T=()=>{(0,H.Fb)(i,H.aT).then((()=>{(0,H.e5)(i,m.value,u.value).then((e=>{console.log("THE USER CREDENTIALS >>>>",e)})).catch((e=>{g()}))})).catch((e=>{e.code;const s=e.message;console.error(s)}))},U=async e=>{const{value:s}=await q().fire({title:"Recuperar sua senha",input:"email",inputLabel:"Digite seu email registrado",inputPlaceholder:"Enter your email address"});s&&(0,H.LS)(e,s).then((()=>{q().fire("Recuperação de senha",`Email de recuperação enviado para ${s}`)})).catch((e=>{const s=e.code;e.message;q().fire("Oooops!",`Houve um erro na recuperação de senha:<br/>${s}`,"error")}))};return{nologged:g,auth:i,login:T,email:m,password:u,firstAccess:t,coreStore:s,resetPass:U,onlineDB:w,projectID:h}},methods:{}};var R=t(11639),T=t(69885),U=t(70335),A=t(8326),D=t(44458),O=t(63190),Z=t(66611),j=t(22857),N=t(11821),W=t(24455),$=t(69984),Q=t.n($);const V=(0,R.Z)(I,[["render",w],["__scopeId","data-v-79268c81"]]),L=V;Q()(I,"components",{QPage:T.Z,QImg:U.Z,QForm:A.Z,QCard:D.Z,QCardSection:O.Z,QInput:Z.Z,QIcon:j.Z,QCardActions:N.Z,QBtn:W.Z})}}]);